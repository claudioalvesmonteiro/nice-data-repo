---
title: An?lise de Dados em R - Bloco 4
author: Claudio A. Monteiro
date: Maio, 2018
output:
   rmdformats::readthedown:
    highlight: kate
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Baixar um banco de dados da internet pelo R
Uma funcionalidade disponível em R é a de baixar arquivos diretamente da web, a partir do link do arquivo. Vamos baixar o banco "data_inova_2008" disponível [aqui](https://raw.githubusercontent.com/claudioalvesmonteiro/municipality-inovation/master/Analysis%20Data/data_inova_2008.csv).

1. Copie o endereço da página web
2. Armazene-o em um objeto como uma *string* 
3. Armazene o nome do arquivo em outro objeto
4. Passe o endereço como primeiro argumento e o nome do arquivo como segundo na função *download.file()*

**Obs:**O arquivo ser? salvo no seu diret?rio de trabalho atual, verifique-se de que o ambiente se encontra no devido diret?rio. 

```{r, include=FALSE}
url <- "https://raw.githubusercontent.com/claudioalvesmonteiro/municipality-inovation/master/Analysis%20Data/data_inova_2008.csv"
destfile <- "data_inova_2008.csv"
download.file(url, destfile)
```

## Manipulando a base

1 - Importe o banco de dados para o R

2 - Informe a estat?stica descritiva (valor m?nimo, m?ximo, m?dia e desvio-padr?o) das seguintes vari?veis do banco: *bur_escol_2008, bur_terc_2008, rec_orcamento_2008, iqb_pcr_2008, cand_age_2008 e cand_sex_2008*


```{r, include=FALSE}
# load data
data_inova_2008 <- read.csv("data_inova_2008.csv", stringsAsFactors  = F) 
```

## Visualiza??o de Dados

Agora vamos trabalhar com a visualiza??o gr?fica de algumas informa??es relevantes.

### 1. Gr?fico de barra
Primeiro vamos fazer um gr?fico de barra com a m?dia do Indicador de Qualidade da Burocracia Municipal (IQBM) por estado da federa??o. Temos uma base de dados dos munic?pios, ent?o devemos calcular a m?dia do IQBM de cada estado com base nos valores de seus respectivos munic?pios:

##### A fun??o *aggregate* ? uma ferramente muito ?til na an?lise de dados em R. Ela aplica uma determinada fun??o a um conjunto de valores. Em nosso exemplo queremos aplicar a fun??o *mean()* para os valores do IQBM, por estado.

```{r}
# executar funcao aggregate
estadoIQB <- aggregate(
  # define a variavel de calculo
  x = data_inova_2008$iqb_pcr_2008,     
  # define a variavel categorica dos estados
  by = list(data_inova_2008$Nome_UF),   
  # define a funcao a ser aplicada
  FUN = mean)                          

# visualizar resultado
estadoIQB
```

##### Agora vamos construir nosso gráfico:

```{r}
# carregar pacote
library(ggplot2)

# define a base de dados, eixo x e eixo y
ggplot(data = estadoIQB, aes(x = estadoIQB$Group.1, y = estadoIQB$x))+ 
  # define o tipo de barra
  geom_bar(stat = "identity")+ 
  # girar barra para horizontal
  coord_flip() 
  
```

Podemos ainda evoluir a visualiza??o do gr?fico. Vamos dar uma olhada nas possibilidades que o R disp?e:

```{r}
 # ordena os dados com base na variavel 'x'
estadoIQB <- estadoIQB[order(estadoIQB$x),]
# tranforma os nomes em fatores com os niveis da ordem
estadoIQB$Group.1 <- factor(estadoIQB$Group.1, levels = estadoIQB$Group.1) 

# arredondar valores
estadoIQB$x <- round(estadoIQB$x, 2)

# novo grafico
plotEstadoIQB <- 
  # define a base de dados, eixo x e eixo y
  ggplot(data = estadoIQB, aes(x = estadoIQB$Group.1, y = estadoIQB$x))+ 
  # define o tipo de barra e a cor
  geom_bar(stat = "identity", fill = "#15041c")+ 
  # adicionar os valores nas barras, define tamanho e posicao
  geom_text(aes(label = estadoIQB$x), size = 3, nudge_y = 0.025)+ 
  # renomear os eixos
  labs(x = "Estados", y = "M?dia IQBM")+ 
  # girar barra para horizontal
  coord_flip() 

plotEstadoIQB
```

Por fim vamos salvar o grafico no diretorio de trabalho:
```{r}
ggsave("plotEstadoIQB.png", # nome do arquivo a ser salvo
       plotEstadoIQB,       # objeto grafico a ser salvo
       width = 7,           # tamanho horizontal
       height = 7,          # tamanho vertical
       units = "in")        # unidade de medida (in = inches = polegadas)
```
